<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>我的与权限管理 - 彩诗禾-数字一体化厂区管控平台</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#16a34a',
            primaryLight: '#dcfce7',
            primarySoft: '#ecfdf3'
          }
        }
      }
    };
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script>
    function openProfileModal() {
      var modal = document.getElementById('profileModal');
      if (modal) modal.classList.remove('hidden');
    }
    function closeProfileModal() {
      var modal = document.getElementById('profileModal');
      if (modal) modal.classList.add('hidden');
    }
    function openAuthLinkModal() {
      var modal = document.getElementById('authLinkModal');
      if (modal) modal.classList.remove('hidden');
    }
    function closeAuthLinkModal() {
      var modal = document.getElementById('authLinkModal');
      if (modal) modal.classList.add('hidden');
    }
    function openUserPermissionModal(userLabel) {
      var modal = document.getElementById('userPermissionModal');
      var title = document.getElementById('userPermissionTitle');
      if (title && userLabel) title.textContent = '配置权限 · ' + userLabel;
      if (modal) modal.classList.remove('hidden');
    }
    function closeUserPermissionModal() {
      var modal = document.getElementById('userPermissionModal');
      if (modal) modal.classList.add('hidden');
    }
    function openShareCopyModal() {
      var modal = document.getElementById('shareCopyModal');
      var tip = document.getElementById('copySuccessTip');
      if (tip) tip.classList.add('hidden');
      if (modal) modal.classList.remove('hidden');
    }
    function closeShareCopyModal() {
      var modal = document.getElementById('shareCopyModal');
      if (modal) modal.classList.add('hidden');
    }
    function simulateCopyLink() {
      var tip = document.getElementById('copySuccessTip');
      if (!tip) return;
      tip.classList.remove('hidden');
      setTimeout(function () {
        tip.classList.add('hidden');
      }, 1500);
    }
  </script>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen">
  <div class="w-[393px] h-[852px] bg-gradient-to-b from-emerald-50 to-white rounded-[40px] shadow-[0_20px_60px_rgba(16,185,129,0.45)] border border-emerald-100 overflow-hidden relative flex flex-col">
    <!-- 状态栏 -->
    <div class="h-11 px-4 flex items-center justify-between text-xs text-slate-700">
      <div class="font-semibold">9:41</div>
      <div class="flex items-center gap-1.5">
        <i class="fa-solid fa-signal"></i>
        <i class="fa-solid fa-wifi"></i>
        <i class="fa-solid fa-battery-full"></i>
      </div>
    </div>

    <!-- 顶部导航 -->
    <div class="px-4 pb-2 flex items-center justify-between">
      <div class="w-8 h-8"></div>
      <div class="text-sm font-semibold text-slate-900">我的 · 权限管理</div>
      <button onclick="openProfileModal()" class="w-8 h-8 rounded-full bg-white/80 border border-emerald-100 flex items-center justify-center text-slate-600 text-xs" aria-label="编辑个人信息">
        <i class="fa-solid fa-gear"></i>
      </button>
    </div>

    <!-- 内容区 -->
    <div class="flex-1 overflow-y-auto px-4 pb-20 bg-gradient-to-b from-emerald-50/80 to-white space-y-3">
      <!-- 当前账号信息（微信授权） -->
      <div class="bg-white rounded-2xl border border-emerald-100 p-3 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <div class="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center text-white text-sm font-semibold">
            管
          </div>
          <div class="text-[11px]">
            <div class="text-slate-900 font-semibold">张三 · 生产管理员</div>
            <div class="text-slate-500">已通过微信授权登录</div>
            <div class="text-emerald-600 mt-0.5">微信昵称：纺一车间-张三</div>
          </div>
        </div>
        <button class="px-2 py-1 rounded-full border border-emerald-200 text-emerald-700 text-[11px]">
          退出
        </button>
      </div>

      <!-- 角色信息与生产线访问权限 -->
      <div class="bg-white rounded-2xl border border-emerald-100 p-3 space-y-2">
        <div class="flex items-center justify-between">
          <span class="text-xs font-medium text-slate-800">角色与访问权限</span>
          <span class="text-[11px] text-slate-500">基于微信身份进行授权</span>
        </div>
        <div class="flex items-center gap-1.5 text-[11px] mb-1">
          <span class="px-2 py-0.5 rounded-full bg-primary text-white">管理员</span>
          <span class="px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700">可配置权限</span>
        </div>
        <div class="text-[11px] text-slate-600 mb-1">
          当前账号拥有以下生产线的数据录入与查看权限：
        </div>
        <div class="flex flex-wrap gap-1.5 text-[11px]">
          <span class="px-2 py-0.5 rounded-full bg-primarySoft text-primary">纺一车间 · 1#线（全工序）</span>
          <span class="px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700">纺一车间 · 2#线（查看）</span>
          <span class="px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700">纺二车间 · 络筒专线（查看）</span>
        </div>
      </div>

      <!-- 微信授权用户列表 -->
      <div class="bg-white rounded-2xl border border-emerald-100 p-3 space-y-2">
        <div class="flex items-center justify-between">
          <span class="text-xs font-medium text-slate-800">微信授权用户管理</span>
          <button onclick="openAuthLinkModal()" class="px-2 py-1 rounded-full bg-primarySoft text-primary text-[11px] flex items-center gap-1">
            <i class="fa-solid fa-link text-[9px]"></i>
            生成授权链接
          </button>
        </div>
        <div class="space-y-1.5 text-[11px]">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-1.5">
              <div class="w-7 h-7 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-700 text-xs">
                值
              </div>
              <div>
                <div class="text-slate-800">李四 · 值班人员</div>
                <div class="text-slate-500">微信昵称：粗纺线-李四</div>
              </div>
            </div>
            <button onclick="openUserPermissionModal('李四 · 值班人员')" class="px-2 py-0.5 rounded-full border border-emerald-200 text-emerald-700 flex items-center gap-1">
              <i class="fa-solid fa-pen text-[9px]"></i> 配置权限
            </button>
          </div>
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-1.5">
              <div class="w-7 h-7 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-700 text-xs">
                查
              </div>
              <div>
                <div class="text-slate-800">王五 · 查看者</div>
                <div class="text-slate-500">微信昵称：厂长-王五</div>
              </div>
            </div>
            <button onclick="openUserPermissionModal('王五 · 查看者')" class="px-2 py-0.5 rounded-full border border-emerald-200 text-emerald-700 flex items-center gap-1">
              <i class="fa-solid fa-pen text-[9px]"></i> 配置权限
            </button>
          </div>
        </div>
      </div>

      <!-- 权限分享 -->
      <div class="bg-white rounded-2xl border border-emerald-100 p-3 space-y-2">
        <div class="flex items-center justify-between">
          <span class="text-xs font-medium text-slate-800">权限分享（查看权限）</span>
          <span class="text-[11px] text-slate-500">通过链接或二维码分享</span>
        </div>
        <div class="flex items-center gap-2">
          <div class="w-16 h-16 rounded-xl border border-dashed border-emerald-200 flex flex-col items-center justify-center text-[10px] text-slate-500">
            <i class="fa-solid fa-qrcode text-slate-600 mb-1"></i>
            <span>示例二维码</span>
          </div>
          <div class="flex-1 text-[11px] text-slate-600">
            可生成仅用于查看的生产线看板授权链接或二维码，对方使用微信打开后即可在有效期内查看对应生产线的数据和看板。
          </div>
        </div>
        <button onclick="openShareCopyModal()" class="w-full mt-1 px-3 py-1.5 rounded-full bg-primary text-white text-[11px] font-medium flex items-center justify-center gap-1">
          <i class="fa-solid fa-share-nodes text-[9px]"></i>
          分享 2#纺纱线 · 查看权限
        </button>
      </div>

      <!-- 系统支撑入口 -->
      <a href="system_logs.html" class="block bg-white rounded-2xl border border-emerald-100 p-3">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-2">
            <div class="w-7 h-7 rounded-xl bg-primarySoft text-primary flex items-center justify-center text-xs">
              日
            </div>
            <div class="text-[11px]">
              <div class="text-slate-900 font-medium">操作日志与告警记录</div>
              <div class="text-slate-500">查看登录、数据录入、权限修改、大模型调用异常等系统行为。</div>
            </div>
          </div>
          <i class="fa-solid fa-chevron-right text-[9px] text-slate-400"></i>
        </div>
      </a>
    </div>

    <!-- 底部 TabBar -->
    <div class="h-16 bg-white/95 border-t border-slate-200 flex items-center justify-around px-2">
      <a href="home.html" class="flex flex-col items-center justify-center gap-0.5 text-slate-400">
        <i class="fa-solid fa-house text-sm"></i>
        <span class="text-[11px]">首页</span>
      </a>
      <a href="inspection_tasks.html" class="flex flex-col items-center justify-center gap-0.5 text-slate-400">
        <i class="fa-solid fa-clipboard-list text-sm"></i>
        <span class="text-[11px]">巡检</span>
      </a>
      <a href="dashboard_overview.html" class="flex flex-col items-center justify-center gap-0.5 text-slate-400">
        <i class="fa-solid fa-chart-column text-sm"></i>
        <span class="text-[11px]">看板</span>
      </a>
      <a href="analytics_reports.html" class="flex flex-col items-center justify-center gap-0.5 text-slate-400">
        <i class="fa-regular fa-file-lines text-sm"></i>
        <span class="text-[11px]">报表</span>
      </a>
      <a href="settings_permissions.html" class="flex flex-col items-center justify-center gap-0.5 text-primary">
        <i class="fa-regular fa-user text-sm"></i>
        <span class="text-[11px] font-medium">我的</span>
      </a>
    </div>
  </div>

  <!-- 个人信息配置弹层 -->
  <div id="profileModal" class="absolute inset-0 bg-black/30 flex items-center justify-center px-4 z-20 hidden">
    <div class="w-full max-w-xs rounded-3xl bg-white shadow-xl border border-emerald-100 p-4 text-[11px]">
      <div class="flex items-center justify-between mb-2">
        <div>
          <div class="text-xs font-semibold text-slate-900">个人信息</div>
          <div class="text-[10px] text-slate-500">配置昵称、职务、头像与联系电话，仅用于系统展示与联系。</div>
        </div>
        <button onclick="closeProfileModal()" class="w-7 h-7 rounded-full bg-slate-100 flex items-center justify-center text-slate-500">
          <i class="fa-solid fa-xmark text-[10px]"></i>
        </button>
      </div>
      <div class="space-y-1.5 mb-2">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center text-white text-sm font-semibold">
            管
          </div>
          <button class="px-2 py-1 rounded-full border border-emerald-200 text-emerald-700 text-[10px]">
            更换头像
          </button>
        </div>
        <div>
          <label class="block mb-0.5 text-slate-600">昵称</label>
          <input class="w-full h-8 rounded-xl border border-emerald-100 px-2 text-[11px]" placeholder="例如：纺一车间-张三" />
        </div>
        <div>
          <label class="block mb-0.5 text-slate-600">职务</label>
          <input class="w-full h-8 rounded-xl border border-emerald-100 px-2 text-[11px]" placeholder="例如：生产管理员" />
        </div>
        <div>
          <label class="block mb-0.5 text-slate-600">联系电话</label>
          <input class="w-full h-8 rounded-xl border border-emerald-100 px-2 text-[11px]" placeholder="例如：138 **** 0000" />
        </div>
      </div>
      <div class="flex items-center justify-end gap-2">
        <button onclick="closeProfileModal()" class="px-3 py-1.5 rounded-full border border-slate-200 text-slate-600">
          取消
        </button>
        <button onclick="closeProfileModal()" class="px-3 py-1.5 rounded-full bg-primary text-white shadow-sm">
          应用
        </button>
      </div>
    </div>
  </div>

  <!-- 授权链接弹层 -->
  <div id="authLinkModal" class="absolute inset-0 bg-black/30 flex items-center justify-center px-4 z-20 hidden">
    <div class="w-full max-w-xs rounded-3xl bg-white shadow-xl border border-emerald-100 p-4 text-[11px]">
      <div class="flex items-center justify-between mb-2">
        <div>
          <div class="text-xs font-semibold text-slate-900">微信授权链接</div>
          <div class="text-[10px] text-slate-500">将该链接发给需要加入的人员，对方通过微信打开并授权后即可进入用户列表。</div>
        </div>
        <button onclick="closeAuthLinkModal()" class="w-7 h-7 rounded-full bg-slate-100 flex items-center justify-center text-slate-500">
          <i class="fa-solid fa-xmark text-[10px]"></i>
        </button>
      </div>
      <div class="space-y-1.5 mb-2">
        <div class="bg-slate-50 rounded-2xl border border-slate-200 px-2.5 py-2 text-[10px] text-slate-700 break-all">
          https://miniapp.caishihe.com/invite?token=abcdef123456
        </div>
        <div class="text-[10px] text-slate-500">
          实际环境中建议设置有效期与可用次数，避免链接被滥用。
        </div>
      </div>
      <div class="flex items-center justify-end gap-2">
        <button onclick="closeAuthLinkModal()" class="px-3 py-1.5 rounded-full border border-slate-200 text-slate-600">
          关闭
        </button>
        <button onclick="closeAuthLinkModal()" class="px-3 py-1.5 rounded-full bg-primary text-white shadow-sm">
          复制链接
        </button>
      </div>
    </div>
  </div>

  <!-- 用户权限配置弹层 -->
  <div id="userPermissionModal" class="absolute inset-0 bg-black/30 flex items-center justify-center px-4 z-20 hidden">
    <div class="w-full max-w-sm rounded-3xl bg-white shadow-xl border border-emerald-100 p-4 text-[11px] max-h-[80vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-2">
        <div>
          <div id="userPermissionTitle" class="text-xs font-semibold text-slate-900">配置权限</div>
          <div class="text-[10px] text-slate-500">为微信授权用户配置角色与可访问车间，车间命名与班次配置保持一致。</div>
        </div>
        <button onclick="closeUserPermissionModal()" class="w-7 h-7 rounded-full bg-slate-100 flex items-center justify-center text-slate-500">
          <i class="fa-solid fa-xmark text-[10px]"></i>
        </button>
      </div>
      <div class="space-y-2 mb-2">
        <div>
          <label class="block mb-0.5 text-slate-600">角色类型</label>
          <div class="grid grid-cols-3 gap-1.5 text-[10px]">
            <button class="px-2 py-1.5 rounded-xl bg-primarySoft text-primary">管理员</button>
            <button class="px-2 py-1.5 rounded-xl bg-emerald-50 text-slate-700">值班人员</button>
            <button class="px-2 py-1.5 rounded-xl bg-emerald-50 text-slate-700">查看者</button>
          </div>
        </div>
        <div>
          <label class="block mb-0.5 text-slate-600">可访问车间</label>
          <div class="flex flex-wrap gap-1.5">
            <button class="px-2 py-0.5 rounded-full bg-primarySoft text-primary text-[10px]">
              纺一车间 · 1#纺纱线
            </button>
            <button class="px-2 py-0.5 rounded-full bg-emerald-50 text-slate-700 text-[10px]">
              纺一车间 · 2#纺纱线
            </button>
            <button class="px-2 py-0.5 rounded-full bg-emerald-50 text-slate-700 text-[10px]">
              纺二车间 · 络筒线
            </button>
            <button class="px-2 py-0.5 rounded-full bg-emerald-50 text-slate-700 text-[10px]">
              纺二车间 · 粗纺线
            </button>
          </div>
        </div>
        <div class="text-[10px] text-slate-500">
          实际实现中，可支持按角色自动推荐默认权限，例如管理员默认拥有所有车间，查看者仅有查看权限。
        </div>
      </div>
      <div class="flex items-center justify-end gap-2">
        <button onclick="closeUserPermissionModal()" class="px-3 py-1.5 rounded-full border border-slate-200 text-slate-600">
          取消
        </button>
        <button onclick="closeUserPermissionModal()" class="px-3 py-1.5 rounded-full bg-primary text-white shadow-sm">
          保存
        </button>
      </div>
    </div>
  </div>

  <!-- 权限分享复制弹层 -->
  <div id="shareCopyModal" class="absolute inset-0 bg-black/30 flex items-center justify-center px-4 z-20 hidden">
    <div class="w-full max-w-xs rounded-3xl bg-white shadow-xl border border-emerald-100 p-4 text-[11px]">
      <div class="flex items-center justify-between mb-2">
        <div>
          <div class="text-xs font-semibold text-slate-900">分享查看权限</div>
          <div class="text-[10px] text-slate-500">生成仅用于查看的看板访问链接和二维码，适用于临时查看者。</div>
        </div>
        <button onclick="closeShareCopyModal()" class="w-7 h-7 rounded-full bg-slate-100 flex items-center justify-center text-slate-500">
          <i class="fa-solid fa-xmark text-[10px]"></i>
        </button>
      </div>
      <div class="space-y-1.5 mb-2">
        <div class="flex items-center gap-2">
          <div class="w-14 h-14 rounded-xl border border-dashed border-emerald-200 flex flex-col items-center justify-center text-[9px] text-slate-500">
            <i class="fa-solid fa-qrcode text-slate-600 mb-1"></i>
            2#纺纱线
          </div>
          <div class="flex-1 text-[10px] text-slate-600">
            示例：2#纺纱线看板查看二维码，实际生成时可根据有效期动态变化。
          </div>
        </div>
        <div class="bg-slate-50 rounded-2xl border border-slate-200 px-2.5 py-2 text-[10px] text-slate-700 break-all">
          https://miniapp.caishihe.com/share?line=2&readonly=1
        </div>
        <div id="copySuccessTip" class="hidden text-[10px] text-emerald-600 mt-0.5">
          复制成功，可将链接粘贴到微信对话中发送给对方。
        </div>
      </div>
      <div class="flex items-center justify-end gap-2">
        <button onclick="closeShareCopyModal()" class="px-3 py-1.5 rounded-full border border-slate-200 text-slate-600">
          关闭
        </button>
        <button onclick="simulateCopyLink()" class="px-3 py-1.5 rounded-full bg-primary text-white shadow-sm">
          复制链接
        </button>
      </div>
    </div>
  </div>
</body>
</html>
